<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í™ˆ</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
  <style>
    body {
      margin: 0 auto;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      background-color: white;
    }
    .main-container {
      display: flex;
      justify-content: center;
      width: auto;
      margin-top: 50px;
    }
    .side-bar {
      width: 200px;
      height: 1000px;
      position: sticky;
      top: 100px;
      margin: 50px;
    }
    .banner-container {
      display: flex;
      flex-direction: column;
      width: auto;
      padding: 20px;
      box-sizing: border-box;
      margin: 0 auto;
    }

    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ & ë²„íŠ¼ */
    .popular-lectures-container {
      display: flex;
      align-items: center;
      width: 1100px;
      position: relative;
      border-bottom: 1px solid lightgray;
    }

    .scroll-container {
      display: flex;
      flex-direction: row;
      gap: 15px;
      overflow: hidden; /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
      width: 1000px; /* ì»¨í…ì¸  í¬ê¸° ì¡°ì • */
      scroll-behavior: smooth; /* ë¶€ë“œëŸ¬ìš´ ì´ë™ */
    }

    .scroll-left, .scroll-right {
      background-color: #6a8eff;
      border: none;
      height: 100px;
      padding: 10px 15px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 10%;
      margin: 5px;
    }

    .scroll-left:hover, .scroll-right:hover {
      background-color: #4c6ef5;
    }


    .class-element {
      position: relative; /* ë‚´ë¶€ ìš”ì†Œì˜ absolute ìœ„ì¹˜ ê¸°ì¤€ */
      flex-shrink: 0;
      cursor: pointer;
      display: inline-block;
      box-sizing: border-box;
      width: 240px;
      height: 200px;
      border-radius: 15px;
      margin-left: 5px;
      margin-right: 5px;
      margin-bottom: 20px;
      box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.10);
      padding: 110px 5px 20px;
      text-align: center;
    }

    .image-box {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100px;
    }

    .image-thumbnail {
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }


    .class-element:hover {
      background-color: #f8f8f8;
    }

    .element-title {
      float: left;
      margin-left: 20px;
    }

    .element-title>p:nth-child(1) {
      font-size: 16px;
      font-weight: bold;
      margin: 0 auto;
      text-align: left;
    }
    
    .image-bookmark:hover{
	content: url("/photo/classes/Bookmark-icon2.png");
	}


    .element-title>p:nth-child(2) {
      margin: 0 auto;
      text-align: left;
      font-size: 12px;
      color: #56555C;
    }

    .image-bookmark {
      float: right;
      margin-right: 17px;
      height: 35px;
    }

    .options {
      display: inline-block;
      margin-left: 12px;
      margin-right: 12px;
    }

    .options>p:nth-child(1) {
      font-weight: bold;
      margin-bottom: 0px;
    }

    .options>p:nth-child(2) {
      color: #757575;
      font-size: 10px;
      margin: 0px;
    }

    .qna-element {
      cursor: pointer;
      display: inline-block;
      width: 310px;
      height: 200px;
      border-radius: 15px;
      margin-left: 5px;
      margin-right: 15px;
      margin-bottom: 20px;
      box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.10);
      padding: 20px;
      justify-content: center;
      text-align: center;
    }
    .content-clamp {
      display: -webkit-box;
      -webkit-line-clamp: 2; /* ìµœëŒ€ 2ì¤„ í‘œì‹œ */
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
    }
    /* ğŸ“– ë…¸íŠ¸ ìŠ¤íƒ€ì¼ */
    .note-style {
      background: #fffaf0; /* ì—°í•œ ë…¸íŠ¸ ìƒ‰ */
      border: 1px solid #ddd;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
      position: relative;
      padding: 20px;
      overflow: hidden;
      min-width: 250px; /* ì¹´ë“œ í¬ê¸° ê°•ì œ ê³ ì • */
      justify-content: space-between; /* ìš”ì†Œë“¤ì´ ìœ„ì•„ë˜ë¡œ ê· í˜• ìˆê²Œ ì •ë ¬ë¨ */
      height: 12rem;
    }

    /* ğŸ“ ë…¸íŠ¸ ì¤„ë¬´ëŠ¬ */
    .note-style::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: repeating-linear-gradient(
              to bottom,
              transparent 0px,
              transparent 24px, /* ì¤„ ê°„ê²© */
              rgba(0, 0, 0, 0.07) 25px, /* ì¤„ ìƒ‰ìƒ (ë” ì—°í•˜ê²Œ) */
              transparent 26px
      );
      z-index: 0 !important;
      pointer-events: none;
    }

    /* ğŸ“Œ ì™¼ìª½ íŒŒë€ ê³µì±… ì¤„ (ìœ„ì¹˜ ê³ ì •) */
    .note-style::after {
      content: '';
      position: absolute;
      top: 0;
      left: 10px; /* ëª¨ë“  ì¹´ë“œì—ì„œ ë™ì¼í•œ ìœ„ì¹˜ */
      width: 3px; /* ëª¨ë“  ì¹´ë“œì—ì„œ ë™ì¼í•œ ë‘ê»˜ */
      height: 100%;
      background-color: rgba(0, 100, 255, 0.5); /* ì—°í•œ íŒŒë€ìƒ‰ */
      z-index: 1;
    }
    .note-style > div.absolute {
      position: absolute;
      bottom: 20px; /* í•˜ë‹¨ì—ì„œ ì¼ì • ê±°ë¦¬ ìœ ì§€ */
      left: 20px;
      right: 20px;
    }
    /* ğŸ“Œ ì§ˆë¬¸ ëª©ë¡ ë° ëŒ“ê¸€ ëª©ë¡ ìŠ¤íƒ€ì¼ ì¡°ì • */
    .my-qna-container {
      background-color: #fff; /* í°ìƒ‰ ë°°ê²½ ìœ ì§€ */
      border: 2px solid #E3EEFF; /* í…Œë‘ë¦¬ ìƒ‰ìƒì„ ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë§ì¶¤ */
      border-radius: 10px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ìœ ì‚¬í•œ ê·¸ë¦¼ì íš¨ê³¼ */
      padding: 20px; /* ì•ˆìª½ ì—¬ë°± */
    }

    /* ğŸ“Œ ê°œë³„ QnA ë° ëŒ“ê¸€ ë°•ìŠ¤ */
    .my-qna-box, .my-comment-box {
      background-color: #fff; /* í°ìƒ‰ ë°°ê²½ ìœ ì§€ */
      border: 2px solid #E3EEFF; /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•œ í…Œë‘ë¦¬ ìƒ‰ */
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•œ ê·¸ë¦¼ì */
      border-radius: 10px; /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ìœ ì‚¬í•œ ë‘¥ê·¼ í…Œë‘ë¦¬ */
      padding: 20px;
      color: #605F5F; /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ì˜ ê¸€ììƒ‰ ìœ ì§€ */
    }

    /* ğŸ“Œ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
    .my-qna-box table, .my-comment-box table {
      width: 100%;
      border-collapse: collapse;
    }

    .my-qna-box th, .my-comment-box th {
      background-color: #E3EEFF; /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•œ ì—°í•œ íŒŒë€ìƒ‰ */
      color: #605F5F; /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•œ ê¸€ì ìƒ‰ìƒ */
      padding: 10px;
      text-align: center;
    }

    .my-qna-box td, .my-comment-box td {
      padding: 10px;
      border-bottom: 1px solid #ccc;
      text-align: center;
    }

    /* ğŸ“Œ í…Œì´ë¸” hover íš¨ê³¼ */
    .my-qna-box tbody tr:hover, .my-comment-box tbody tr:hover {
      background-color: #F8F9FF; /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•œ hover íš¨ê³¼ */
      cursor: pointer;
    }

    /* ğŸ“Œ ê¸€ì ìŠ¤íƒ€ì¼ ì¡°ì • */
    .my-qna-box h3, .my-comment-box h3 {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    /* ğŸ“Œ ê¸€ ì œëª© ë° ëŒ“ê¸€ ë‚´ìš© ì¤„ì„ */
    .my-qna-box .ellipsis, .my-comment-box .ellipsis {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }

    /* ğŸ“Œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .write-button button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 20px;
      cursor: pointer;
    }

    .write-button button:hover {
      background-color: #0056b3;
    }


  </style>
</head>
<body>
<div class="main-container">
  <div class="side-bar">
    <div th:replace="~{views/menu-bar.html}"></div>
  </div>

  <div class="banner-container">
    <h2>ğŸš€ ì¸ê¸° ê°•ì˜</h2>
    <div class="popular-lectures-container">
      <button class="scroll-left">
        <i class="material-icons" style="color: white">arrow_back_ios</i>

      </button> <!-- ì™¼ìª½ ì´ë™ ë²„íŠ¼ -->
      <div class="scroll-container">
        <div class="class-element" th:each="lec : ${popularLectures}">
          <input type="hidden" name="lectureNo" th:value="${lec.lecNo}">
          <div class="image-box">
            <img src="/photo/classes/example.png" class="image-thumbnail">
          </div>
          <div class="element-title">
            <p>[[${lec.lecTitle}]]</p>
            <p>[[${lec.cgName}]]</p>
          </div>
          <div class="bookmark" th:if="${lec.bookmarkCheck == 'Y'}">
         		<input type="hidden" name="lectureNo" th:value="${lec.lecNo}">
         		<input type="hidden" name="lecturebookmarkCheck" th:value="${lec.bookmarkCheck}">
              <img src="/photo/classes/Bookmark-icon2.png" class="image-bookmark"/>
          </div>
          <div class="bookmark" th:if="${lec.bookmarkCheck == 'N'}">
         		<input type="hidden" name="lectureNo" th:value="${lec.lecNo}">
         		<input type="hidden" name="lecturebookmarkCheck" th:value="${lec.bookmarkCheck}">
              <img src="/photo/classes/bookmark-icon.png" class="image-bookmark"/>
          </div>
          <br><br>
          <div class="option-list">
            <div class="options">
              <p>[[${lec.totalChap}]]</p>
              <p>Chapter</p>
            </div>
            <div class="options">
              <p>[[${lec.progressRate == 0 ? "X" : lec.progressRate + "%"}]]</p>
              <p>Percent</p>
            </div>
            <div class="options">
              <p>[[${lec.svgRate == 0 ? "X" : lec.svgRate}]]</p>
              <p>Rating(5)</p>
            </div>
          </div>
        </div>
      </div>
      <button class="scroll-right">
        <i class="material-icons" style="color: white">arrow_forward_ios</i>
      </button> <!-- ì˜¤ë¥¸ìª½ ì´ë™ ë²„íŠ¼ -->
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-4">
      <h2>ğŸ”¥ì¡°íšŒìˆ˜ TOP3 ì§ˆë¬¸</h2>
      <!-- ì¸ê¸° ì§ˆë¬¸ ì¹´ë“œ ë°˜ë³µë¬¸ ì ìš© -->
      <div class="bg-white shadow-lg rounded-xl p-4 border border-gray-200 qna-element note-style flex flex-col"
           th:each="pq : ${popularQna}">
        <input type="hidden" name="qnaNo" th:value="${pq.qnaNo}">
        <h3 class="text-lg font-semibold truncate content-clamp" th:text="${pq.qnaTitle}">
          ğŸ”¥ ì§ˆë¬¸ ì œëª©
        </h3>
        <p class="text-gray-600 text-sm content-clamp flex-grow my-2" th:text="${pq.qnaDetail}">
          ì§ˆë¬¸ ë‚´ìš©ì˜ ì¼ë¶€ê°€ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤...
        </p>
        <div class="flex justify-between text-gray-500 text-xs absolute bottom-4 left-4 right-4">
          <span class="flex items-center">
              ğŸ‘ï¸â€ğŸ—¨ï¸ <span th:text="${pq.views}" class="ml-1"></span> ì¡°íšŒ
          </span>
          <span class="flex items-center">
              ğŸ’¬ <span th:text="${pq.replyCount}" class="ml-1"></span> ëŒ“ê¸€
          </span>
        </div>
      </div>
    </div>

    <div class="flex gap-6 justify-center p-6 my-qna-container">
      <!-- ğŸ“Œ ë‚´ê°€ ì“´ ì§ˆë¬¸ ëª©ë¡ -->
      <div class="my-qna-box w-[500px] p-4 rounded-lg shadow-md border border-gray-300 relative">
        <h3 class="font-semibold text-lg mb-3 text-center">ğŸ“– ë‚´ê°€ ì“´ ì§ˆë¬¸ê¸€ (ìµœì‹ ìˆœ 5ê°œ)</h3>
        <table class="w-full text-sm border-collapse">
          <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">ì¹´í…Œê³ ë¦¬</th>
            <th class="p-2 border">ê¸€ì œëª©</th>
            <th class="p-2 border">ì‘ì„±ì¼</th>
            <th class="p-2 border">ì¡°íšŒìˆ˜</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="qna : ${myRecentQna}" class="hover:bg-gray-50 myRecQna">
            <input type="hidden" name="qnaNo" th:value="${qna.qnaNo}">
            <td class="p-2 border ellipsis" th:text="${qna.cgName}"></td>
            <td class="p-2 border">
              <a class="ellipsis" th:text="${#strings.length(qna.qnaTitle) > 15 ? #strings.substring(qna.qnaTitle, 0, 15) + '...' : qna.qnaTitle}">
              </a>
            </td>
            <td class="p-2 border" th:text="${#dates.format(qna.createDate, 'yyyy-MM-dd')}"></td>
            <td class="p-2 border" th:text="${qna.views}"></td>
          </tr>
          </tbody>

        </table>
      </div>

      <!-- ğŸ“Œ ë‚´ê°€ ì“´ ëŒ“ê¸€ ëª©ë¡ -->
      <div class="my-comment-box w-[500px] p-4 rounded-lg shadow-md border border-gray-300 relative">
        <h3 class="font-semibold text-lg mb-3 text-center">ğŸ“ ë‚´ê°€ ì“´ ëŒ“ê¸€ (ìµœì‹ ìˆœ 5ê°œ)</h3>
        <table class="w-full text-sm border-collapse">
          <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border">ì¹´í…Œê³ ë¦¬</th>
            <th class="p-2 border">ì§ˆë¬¸ê¸€ ì œëª©</th>
            <th class="p-2 border">ëŒ“ê¸€ ë‚´ìš©</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="rc : ${myRecentComments}" class="hover:bg-gray-50 text-center myRecComm">
            <input type="hidden" name="qnaNo" th:value="${rc.qnaNo}">
            <td class="p-2 border ellipsis" th:text="${rc.cgName}"></td>
            <td class="p-2 border">
              <a class="ellipsis" th:text="${#strings.length(rc.qnaTitle) > 15 ? #strings.substring(rc.qnaTitle, 0, 15) + '...' : rc.qnaTitle}"></a>
            </td>
            <td class="p-2 border ellipsis"
                th:text="${#strings.length(rc.repComment) > 30 ? #strings.substring(rc.repComment, 0, 30) + '...' : rc.repComment}"></td>
          </tr>
          </tbody>

        </table>
      </div>
    </div>


    </div>
  </div>


<script th:inline="javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const scrollContainer = document.querySelector(".scroll-container");
    const scrollLeft = document.querySelector(".scroll-left");
    const scrollRight = document.querySelector(".scroll-right");
    const bookmarks = document.getElementsByClassName("bookmark");
    const loginUser = /*[[${session.loginUser != null}]]*/1;

    // ì¹´ë“œ í•˜ë‚˜ì˜ ë„ˆë¹„ (ì´ë™ ê±°ë¦¬ ì„¤ì •)
    const cardWidth = document.querySelector(".class-element").offsetWidth + 15;

    let isAnimating = false; // ì• ë‹ˆë©”ì´ì…˜ ì¤‘ë³µ ë°©ì§€

    // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤
    function smoothScroll(targetPosition) {
      isAnimating = true;
      const startPosition = scrollContainer.scrollLeft;
      const distance = targetPosition - startPosition;
      const duration = 400; // ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ (ms)
      let startTime = null;

      function animation(currentTime) {
        if (!startTime) startTime = currentTime;
        const timeElapsed = currentTime - startTime;
        const progress = Math.min(timeElapsed / duration, 1);

        scrollContainer.scrollLeft = startPosition + distance * easeOutCubic(progress);

        if (timeElapsed < duration) {
          requestAnimationFrame(animation);
        } else {
          isAnimating = false;
        }
      }

      requestAnimationFrame(animation);
    }

    // ê°€ì†ë„ ì• ë‹ˆë©”ì´ì…˜
    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    // ì™¼ìª½ ì´ë™ ë²„íŠ¼ í´ë¦­
    scrollLeft.addEventListener("click", () => {
      if (!isAnimating) {
        smoothScroll(scrollContainer.scrollLeft - cardWidth);
      }
    });

    // ì˜¤ë¥¸ìª½ ì´ë™ ë²„íŠ¼ í´ë¦­
    scrollRight.addEventListener("click", () => {
      if (!isAnimating) {
        smoothScroll(scrollContainer.scrollLeft + cardWidth);
      }
    });

    // ê°•ì˜ í´ë¦­
    const lecElements = document.getElementsByClassName("class-element");
    for (const element of lecElements) {
      const lecNo = element.children[0].value;
      element.addEventListener("click", () => {
        location.href = "lecture/" + lecNo;
      });
    }
    // ì¡°íšŒìˆ˜ ì§ˆë¬¸ í´ë¦­
    const qnaElement = document.getElementsByClassName("qna-element");
    for (const element of qnaElement) {
      const qnaNo = element.children[0].value;
      element.addEventListener("click", () => {
        location.href = "qna/" + qnaNo + "/" + 1;
      });
    }

    const myRecentQna = document.getElementsByClassName("myRecQna");
    for (const element of myRecentQna) {
      const qnaNo = element.children[0].value;
      element.addEventListener("click", () => {
        location.href = "qna/" + qnaNo + "/" + 1;
      });
    }

    const myRecentComments = document.getElementsByClassName("myRecComm");
    for (const element of myRecentComments) {
      const qnaNo = element.children[0].value;
      element.addEventListener("click", () => {
        location.href = "qna/" + qnaNo + "/" + 1;
      });
    }
    
	for(const bookmark of bookmarks){
		const bookmarkCheck = bookmark.children[1].value
		bookmark.addEventListener('click', (event)=>{
			if(loginUser){
				const lecNo = bookmark.children[0].value
				if(bookmarkCheck == "N"){
					$.ajax({
    					url: "/lecture/insertBookmark",
   						data: {lecNo:lecNo},
   		            	 success: data=>{
   		            		 if(data = 1){
   		            			 alert("í˜„ì¬ ê°•ì˜ë¥¼ ë¶ë§ˆí¬ì— ë“±ë¡í•˜ì˜€ìŠµë‹ˆë‹¤");
   		            			 location.reload(true);
   		            		 }
   		            	 },
   		            	 error: data=> console.log(data)
   		             }) 
				}else if(bookmarkCheck == "Y"){
					$.ajax({
    					url: "/lecture/deleteBookmark",
   						data: {lecNo:lecNo},
   		            	 success: data=>{
   		            		 if(data = 1){
   		            			 alert("í˜„ì¬ ê°•ì˜ë¥¼ ë¶ë§ˆí¬ì— í•´ì œí•˜ì˜€ìŠµë‹ˆë‹¤");
   		            			 location.reload(true);
   		            		 }
   		            	 },
   		            	 error: data=> console.log(data)
   		             }) 
				}
			}else{
				alert("ë¡œê·¸ì¸ì„ í•´ì•¼ ë¶ë§ˆí¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤");
			}
			

			event.stopPropagation();
		})
	}
    
    
  });

</script>

</body>
</html>
